# short-url
Задание 2. «Сокращатель ссылок»

Предположим, мы хотим написать свой собственный сокращатель ссылок (такой,
как bit.ly), и попросили вас написать API, который будет реализовывать
основную функциональность сервиса.

Для пользователя должны быть доступны следующие возможности:

1. Создать новую сокращенную ссылку (дать длинную, получить короткую)
2. Перейти по короткой ссылке и быть перенаправленным на исходную длинную ссылку
3. Просмотреть список «своих» ссылок, которые он сокращал
4. Просмотреть статистику переходов по каждой ссылке


Примечание

Если при решении этой задачи вы будете использовать БД, не забудьте приложить
в README.md инструкции по настройке выбранной вами БД для проверяющего (скрипты
создания таблиц для реляционных БД, конфиги, и прочее).

Задача довольно объемная, поэтому пользовательский интерфейс можно не делать, достаточно API с примерами запросов для каждого действия пользователя.
Пользовательский интерфейс является плюсом, но не является обязательным.

Обратите внимание на время работы основного сценария – открытия короткой ссылки
и превращения ее в длинную. После того, как приложение начнет работать корректно,
протестируйте его скорость работы при помощи утилит нагрузочного тестирования
(wrk, ab и подобных), и попробуйте оптимизировать приложение с точки зрения
скорости работы.

Зафиксируйте в README.md, как и чем тестировали, какие показатели были в начале
работы, какие в итоге, и какие шаги по оптимизации вы предпринимали.


v1. Каркас приложения без БД. Информация о ссылках хранится в переменной в коде. 
Роуты:
    - /?link=... создает укороченную ссылку для link и возвращает созданную короткую ссылку
    - /mylinks возвращает массив ссылок, которые создавал пользователь
    - /... переход по короткой ссылке

Тестирование с помощью wrk:

Running 30s test @ http://localhost:3000/kVmNKpBC
  12 threads and 400 connections
  Thread Stats   Avg      Stdev     Max   +/- Stdev
    Latency    58.39ms   12.97ms 339.14ms   87.50%
    Req/Sec   562.98    133.84     0.91k    79.95%
  201507 requests in 30.08s, 47.47MB read
Requests/sec:   6699.16
Transfer/sec:      1.58MB

v2. Приложение с БД. Информация хранится в базе, 2 простых таблицы.
Роуты:
    - /?link=... создает укороченную ссылку для link и возвращает созданную короткую ссылку
    - /... переход по короткой ссылке
    - /info/mylinks возвращает массив ссылок, которые создавал пользователь
    - /info/stat?link=... возвращает информацию о ссылке, параметры day=true, month=true указывают, что необходимо вернуть количество посещений за день и за месяц соответственно

Для того, чтобы пользователь мог посмотреть свои ранее созданные ссылки, используется токен, который выдается при создании первой ссылки пользователем. Он хранится в куки.
При создании новой ссылки проверяется, не создавал ли пользователь короткой сслыки для этой же длинной ссылки. Также, перед длинной ссылкой добавляется 'http://', если пользователь не указал явно.
При каждом переходе по короткой ссылке происходит:
    - поиск в базе данных записи, содержащей длинную ссылку для перехода;
    - создание в базе данных записи о посещении данной ссылки.
Соответственно, время отклика увеличивается по сравнению с предыдущей версией.

Тестирование с помощью wrk:

Running 30s test @ http://localhost:3000/rslvxwbf
  12 threads and 400 connections
  Thread Stats   Avg      Stdev     Max   +/- Stdev
    Latency   816.91ms  504.48ms   1.97s    63.35%
    Req/Sec    29.89     29.42   210.00     79.80%
  3091 requests in 30.05s, 751.62KB read
  Socket errors: connect 0, read 0, write 0, timeout 2518
Requests/sec:    102.85
Transfer/sec:     25.01KB

Среднее время увеличилось с 58 мс до 816 мс, максимальное с 339 мс до 1,97с!